openapi: 3.0.3

info:
  title: Library Manager API
  version: 1.0.0
  contact:
    name: DEV (Napoleon Avila Ochoa)
    email: napoavi@gmail.com
  description: API for library management services.

servers:
  - url: http://localhost:8080/v1
    description: Development environment
  - url: https://api.library.com/v1
    description: Production environment

tags:
  - name: Library Manager
    description: API to manage books in library by different criteria

paths:
  /v1/books:
    post:
      summary: Create a new book
      description: Create a new book in the library
      operationId: createBook
      tags:
        - Books
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookRequest'
            examples:
              createBookExample:
                summary: Example of book creation
                value:
                  title: "Clean Code"
                  author: "Robert C. Martin"
                  bookGenre: "Programming"
                  pages: 250
                  publicationYear: 2008
      responses:
        '201':
          description: Successfully created book
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookResponse'
              examples:
                bookCreatedExample:
                  summary: Book created
                  value:
                    id: 1
                    title: "Clean Code"
                    author: "Robert C. Martin"
                    publicationYear: 2008
                    bookGenre: "Programming"
                    pages: 350
                    createdAt: "2025-12-07T20:57:00Z"
                    updatedAt: "2025-12-07T20:57:00Z"
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidRequestExample:
                  value:
                    timestamp: "2025-12-07T20:57:00Z"
                    status: 400
                    error: "Bad Request"
                    message: "The 'title' field is required"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                server_error:
                  summary: Internal server error
                  value:
                    code: "INTERNAL_ERROR"
                    message: "An unexpected error occurred while processing the request"
                    timestamp: "2024-06-03T14:30:00Z"

    get:
      tags:
        - Books
      summary: List all active books
      description: |
        Retrieves a paginated list of all books with status active.
        Supports pagination, sorting, and filtering.
      operationId: getBooks
      parameters:
        - name: page
          in: query
          description: Page number to retrieve (1-indexed). First page is 1.
          required: false
          schema:
            type: integer
            format: int32
            default: 1
            minimum: 1
            example: 1
        - name: pageSize
          in: query
          description: Number of items per page
          required: false
          schema:
            type: integer
            format: int32
            default: 10
            minimum: 1
            maximum: 100
            example: 10
        - name: sortDirection
          in: query
          description: Sort direction (ASC or DESC)
          required: false
          schema:
            type: string
            enum:
              - ASC
              - DESC
            default: ASC
            example: ASC
        - name: sortBy
          in: query
          description: |
            Field to sort by.
            Allowed values: id, title, author, bookGenre, publicationYear
          required: false
          schema:
            type: string
            enum:
              - id
              - title
              - author
              - publicationYear
              - bookGenre
            default: title
            example: title
        - name: author
          in: query
          description: Filter books by author name
          required: false
          schema:
            type: string
            maxLength: 250
            example: "García Márquez"
        - name: title
          in: query
          description: Filter books by title
          required: false
          schema:
            type: string
            maxLength: 250
            example: "Cien años de soledad"
        - name: genre
          in: query
          description: Filter books by genre
          required: false
          schema:
            type: string
            enum:
              - FICTION
              - NON_FICTION
              - CLASSIC
              - MYSTERY
              - HISTORICAL_FICTION
              - FANTASY
              - ROMANCE
              - SCIENCE_FICTION
              - CHILDREN
              - ESSAY
              - ADVENTURE
              - OTHER
            example: "FANTASY"

      responses:
        "200":
          description: Books successfully listed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BooksResponse"
              examples:
                success_response:
                  summary: Successful list response
                  value:
                    books:
                      - id: 5
                        title: "Book 1"
                        author: "Author 1"
                        gender: "Gender 1"
                        pages: 350
                        year: 2001
                        createdAt: "2025-12-07T20:57:00Z"
                        updatedAt: "2025-12-07T20:57:00Z"
                      - id: 1
                        title: "Book 2"
                        author: "Author 2"
                        gender: "Gender 2"
                        pages: 120
                        year: 1989
                        createdAt: "2025-12-07T20:57:00Z"
                        updatedAt: "2025-12-07T20:57:00Z"
                      - id: 2
                        title: "Book 3"
                        author: "Author 3"
                        gender: "Gender 3"
                        pages: 500
                        year: 2021
                        createdAt: "2025-12-07T20:57:00Z"
                        updatedAt: "2025-12-07T20:57:00Z"
                    pagination:
                      timestamp: "2024-06-03T14:30:00Z"
                      size: 10
                      totalPages: 5,
                      number: 0,
                      totalElements: 100
        "400":
          description: Invalid criteria
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                invalid_weights:
                  summary: Invalid weight values
                  value:
                    code: "INVALID_CRITERIA"
                    message: "Weight values must be non-negative numbers"
                    timestamp: "2024-06-03T14:30:00Z"
                missing_weights:
                  summary: Missing criteria
                  value:
                    code: "MISSING_CRITERIA"
                    message: "At least one sorting criteria weight must be provided"
                    timestamp: "2024-06-03T14:30:00Z"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                server_error:
                  summary: Internal server error
                  value:
                    code: "INTERNAL_ERROR"
                    message: "An unexpected error occurred while processing the request"
                    timestamp: "2024-06-03T14:30:00Z"

  /v1/books/{id}:
    delete:
      tags:
        - Books
      summary: Deactivate book by ID
      description: Deactivate a book in the library
      operationId: deactivateBook
      parameters:
        - name: id
          in: path
          description: ID of the book to get
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "204":
          description: Book successfully deactivated
        '404':
          description: Book not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidRequestExample:
                  value:
                    timestamp: "2025-12-07T20:57:00Z"
                    status: 400
                    error: "Nof found"
                    message: "Book not found"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                server_error:
                  summary: Internal server error
                  value:
                    code: "INTERNAL_ERROR"
                    message: "An unexpected error occurred while processing the request"
                    timestamp: "2024-06-03T14:30:00Z"

    get:
      tags:
        - Books
      summary: Get active book by ID
      description: Get a book active in the library
      operationId: getBook
      parameters:
        - name: id
          in: path
          description: ID of the book to get
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: Book successfully recovered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BookResponse"
              examples:
                success_response:
                  summary: Successful list response
                  value:
                    books:
                      - id: 5
                        title: "Book 1"
                        author: "Author 1"
                        gender: "Gender 1"
                        pages: 350
                        year: 2001
                        createdAt: "2025-12-07T20:57:00Z"
                        updatedAt: "2025-12-07T20:57:00Z"
        '404':
          description: Book not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidRequestExample:
                  value:
                    timestamp: "2025-12-07T20:57:00Z"
                    status: 400
                    error: "Nof found"
                    message: "Book not found"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                server_error:
                  summary: Internal server error
                  value:
                    code: "INTERNAL_ERROR"
                    message: "An unexpected error occurred while processing the request"
                    timestamp: "2024-06-03T14:30:00Z"

    put:
      summary: Update a book by ID
      description: Update a book in the library
      operationId: updateBook
      tags:
        - Books
      parameters:
        - name: id
          in: path
          description: ID of the book to update
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookRequest'
            examples:
              updateBookExample:
                summary: Example of book updated
                value:
                  title: "Clean Code"
                  author: "Robert C. Martin"
                  bookGenre: "Programming"
                  pages: 250
                  publicationYear: 2008
      responses:
        '200':
          description: Successfully updated book
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookResponse'
              examples:
                bookUpdatedExample:
                  summary: Book updated
                  value:
                    id: 1
                    title: "Clean Code"
                    author: "Robert C. Martin"
                    publicationYear: 2008
                    bookGenre: "Programming"
                    pages: 350
                    createdAt: "2025-12-07T20:57:00Z"
                    updatedAt: "2025-12-08T20:58:00Z"
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidRequestExample:
                  value:
                    timestamp: "2025-12-07T20:57:00Z"
                    status: 400
                    error: "Bad Request"
                    message: "The 'title' field is required"
        '404':
          description: Book not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidRequestExample:
                  value:
                    timestamp: "2025-12-07T20:57:00Z"
                    status: 400
                    error: "Bad Request"
                    message: "The 'title' field is required"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              examples:
                server_error:
                  summary: Internal server error
                  value:
                    code: "INTERNAL_ERROR"
                    message: "An unexpected error occurred while processing the request"
                    timestamp: "2024-06-03T14:30:00Z"

components:
  schemas:

    Link:
      type: object
      properties:
        rel:
          type: string
          description: Relación (qué se puede hacer)
          example: "self"
        href:
          type: string
          description: La URL para realizar la acción
          example: "/v1/books/1"
        method:
          type: string
          description: Método HTTP necesario
          example: "GET"

    BookRequest:
      type: object
      required:
        - title
        - author
        - bookGenre
      properties:
        title:
          type: string
          description: Book Title
          example: "Clean Code"
          minLength: 1
          maxLength: 255
        author:
          type: string
          description: Book Author
          example: "Robert C. Martin"
          minLength: 1
          maxLength: 255
        publicationYear:
          type: integer
          description: Year of publication
          example: 2008
          minimum: 1000
        bookGenre:
          description: Literary genre
          type: string
          enum:
            - FICTION
            - NON_FICTION
            - CLASSIC
            - MYSTERY
            - HISTORICAL_FICTION
            - FANTASY
            - ROMANCE
            - SCIENCE_FICTION
            - CHILDREN
            - ESSAY
            - ADVENTURE
            - OTHER
          example: "FANTASY"
        pages:
          type: integer
          description: Total pages
          example: 150
          minimum: 1

    BooksResponse:
      type: object
      required:
        - books
        - pagination
      properties:
        books:
          type: array
          description: List of books active
          items:
            $ref: "#/components/schemas/BookResponse"
        pagination:
          $ref: "#/components/schemas/Pagination"
        links:
          type: array
          description: Enlaces de navegación de paginación (next, prev, self, etc.)
          items:
            $ref: '#/components/schemas/Link'

    BookResponse:
      type: object
      required:
        - id
        - title
        - author
        - bookGenre
        - pages
      properties:
        id:
          type: integer
          format: int64
          description: Book identifier
          example: 1
        title:
          type: string
          description: title
          example: "Orgullo y prejucio"
        author:
          type: string
          description: author
          example: "Jane Austen"
        bookGenre:
          type: string
          description: genre
          example: "NOVEL"
        pages:
          type: integer
          description: Number of pages
          minimum: 1
          example: 100
        publicationYear:
          type: integer
          description: Year of publish
          example: 1813
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the book was created
          example: "2024-06-03T14:30:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the book was updated
          example: "2024-06-03T14:30:00Z"
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'

    Pagination:
      type: object
      description: Pagination information
      properties:
        timestamp:
          type: string
          format: date-time
          description: Timestamp when the request was performed
          example: "2024-06-03T14:30:00Z"
        size:
          type: integer
          format: int32
        totalPages:
          type: integer
          format: int32
        number:
          type: integer
          format: int32
        totalElements:
          type: integer
          format: int64

    Error:
      type: object
      required:
        - code
        - message
        - timestamp
      properties:
        code:
          type: string
          description: Error code identifier
          enum:
            - "NOT_FOUND"
            - "INVALID_CRITERIA"
            - "VALIDATION_ERROR"
            - "INTERNAL_ERROR"
            - "INVALID_JSON"
            - "INVALID_PARAMETER"
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: Human-readable error message
          example: "Weight values must be non-negative numbers"
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
          example: "2024-06-03T14:30:00Z"
        details:
          type: object
          description: Additional error details (optional)
          additionalProperties: true
          example:
            field: "Error in value"